!function(i){i.entwine("ss",function(i){i(".ss-gridfield").entwine({showNoItemsMessage:function(){0===this.find(".ss-gridfield-items:first").children().not(".ss-gridfield-no-items").length&&this.find(".ss-gridfield-no-items").show()}}),i(".gridfield-help-button-dialog").entwine({loadDialog:function(i){var e=this.addClass("loading").children(".ui-dialog-content").empty();i.done(function(i){e.html(i).parent().removeClass("loading")})}}),i(".ss-gridfield .gridfield-help-button").entwine({onclick:function(){var e=i("<div></div>").appendTo("body").dialog({modal:!1,resizable:!0,width:600,height:600,close:function(){i(this).dialog("destroy").remove()}});return e.parent().addClass("gridfield-help-button-dialog").loadDialog(i.get(this.prop("href"))),e.data("grid",this.closest(".ss-gridfield")),!1}}),window.GridFieldUtils_Modal={$trigger:null,$dialog:null,$grid:null,reload:!1,closeOnStateChange:!1},window.GridFieldUtils_Modal.open=function(e){var d=this;d.$trigger=e;var t=e.closest(".ss-gridfield"),s=i('<div class="ss-gridfield-modal"></div>'),n=i.extend({},{width:.8,height:.8,resizable:!1},t.data("modalDimensions")||{}),a=function(i){i.find("html").addClass("ss-gridfield-modal--body"),i.find(".cms-menu").remove()};d.$grid=t,d.$dialog=s,d.$dialog.ssdialog({iframeUrl:e[0].href,width:n.width<1?n.width*window.innerWidth:n.width,minWidth:n.width<1?n.width*window.innerWidth:n.width,height:n.height<1?n.height*window.innerHeight:n.height,minHeight:n.height<1?n.height*window.innerHeight:n.height,resizable:n.resizable,close:function(){d.close()}}),d.$dialog.find("iframe").addClass("loading").off("load.reloading").one("load.reloading",function(e){var d=i(this),t=d.contents();t.find(".ss-loading-screen").show(),t.find("body").addClass("loading"),d.addClass("ss-gridfield-modal_reloaded").attr("src",function(i,e){return e})}),d.$dialog.find("iframe").on("load.gridfield",function(){var e=i(this),t=e.contents();a(t),e.hasClass("ss-gridfield-modal_reloaded")&&e.removeClass("loading"),d.initModal(t)}),d.$dialog.ssdialog("open")},window.GridFieldUtils_Modal.initModal=function(e){e||(e=this.$dialog.find("iframe").contents()),e.find(".ss-gridfield-modal-form:first").each(function(){var d=i(this),t=d.data("nonModalLink"),s=d.data("modalLink"),n=function(i,e){i.attr(e,i.attr(e).replace(t,s))};e.find('[src^="'+t+'"]').each(function(){n(i(this),"src")}),e.find('[action^="'+t+'"]').each(function(){n(i(this),"action")}),e.find('[href^="'+t+'"]').each(function(){n(i(this),"href")})})},window.GridFieldUtils_Modal.close=function(i){this.$trigger.Dialog=null,this.$dialog.ssdialog("destroy").remove(),(this.reload||i)&&this.$grid.reload(),this.$trigger=null,this.$grid=null,this.$dialog=null,this.reload=!1},window.GridFieldUtils_Modal.reloadGrid=function(){this.$grid.reload()},window.GridFieldUtils_Modal.reloadOnClose=function(){this.reload=!0},window.GridFieldUtils_Modal.doCloseOnStateChange=function(){this.closeOnStateChange=!0},i(".ss-gridfield-modal--button").entwine({Dialog:null,onclick:function(e){e.preventDefault(),e.stopPropagation(),window.GridFieldUtils_Modal.open(i(this))}}),i(".ss-gridfield-modal--body").entwine({onadd:function(){window.parent.GridFieldUtils_Modal.initModal()}}),i(".ss-gridfield-modal--body .cms_backlink a").entwine({onclick:function(i){i.preventDefault(),i.stopPropagation(),window.parent.GridFieldUtils_Modal.close()}}),i(".ss-gridfield-modal--body .breadcrumbs-wrapper a").entwine({onclick:function(i){i.preventDefault(),i.stopPropagation(),this[0].href==window.parent.location.href?window.parent.GridFieldUtils_Modal.close():window.parent.location.href=this[0].href}}),i(".ss-gridfield-modal--body form").entwine({onsubmit:function(){window.parent.GridFieldUtils_Modal.reloadOnClose()},onaftersubmitform:function(i,e,d){window.parent.GridFieldUtils_Modal.initModal()}}),i(".ss-gridfield-modal--body .cms-container").entwine({onafterstatechange:function(){window.parent.GridFieldUtils_Modal.initModal()},handleAjaxResponse:function(e,d,t,s){window.parent.GridFieldUtils_Modal.initModal();var n=this.find(".ss-gridfield-modal-form:first"),a=n.data("nonModalLink"),l=n.data("modalLink");if(a&&l&&t.getResponseHeader("X-ControllerURL")){var r=i("base").attr("href"),o=t.getResponseHeader("X-ControllerURL"),g=i.path.isAbsoluteUrl(o)?o:i.path.makeUrlAbsolute(o,r);return g.startsWith(i.path.isAbsoluteUrl(a)?a:i.path.makeUrlAbsolute(a,r))&&(g=g.replace(a,l)),void(window.location.href=g)}return this._super(e,d,t,s)}}),i(".ss-gridfield-hasOneSelector-reset_button[data-relation]").entwine({onclick:function(){return this.parents(".ss-gridfield:first").find('td[data-relation="'+this.data("relation")+'"] ').each(function(){i(this).find("input").prop("checked",!1)}),!1}}),i(".ss-gridfield-hasOneSelector-toggle[data-relation]").entwine({onclick:function(){var e=this.prop("checked");this.parents(".ss-gridfield:first").find('td[data-relation="'+this.data("relation")+'"] ').each(function(){i(this).find("input").prop("checked",!e)})}}),i(".ss-gridfield.ss-gridfield-add-inline-extended--table").entwine({reload:function(i,e){var d=this,t=d.find("tbody:first").find(".ss-gridfield-inline-new-extended--row").detach(),s=arguments;this._super(i,function(){t.length&&(d.data("prepend")?t.prependTo(d.find("tbody:first")):t.appendTo(d.find("tbody:first")),d.find("tbody:first").children(".ss-gridfield-no-items:first").hide()),e&&e.apply(d,s)})},onaddnewinlinextended:function(e,d){if(e.target==this[0]){var t=this,s=t.find("tbody:first"),n=t.data("add-inline-num")||1;if(d&&d.data("ajax")){var a=d.hasClass("ss-ui-action-constructive"),l=d.siblings(".ss-gridfield-inline-new-extended--class-selector:first").find(":input"),r={_datanum:n};if(l.length){if(!l.val())return void alert("Please select a type to create");r[t.attr("id")+"_modelClass"]=l.val()}d.addClass("ss-gridfield-add-inline-extended--loading disabled ss-ui-button-loading"),d.find(".ui-icon").addClass("ss-ui-loading-icon"),a&&d.removeClass("ss-ui-action-constructive"),i.ajax({url:d[0].href,dataType:"html",data:r,success:function(e){d.removeClass("ss-gridfield-add-inline-extended--loading disabled ss-ui-button-loading"),d.find(".ui-icon").removeClass("ss-ui-loading-icon");var n=i(e);n.find("ss-gridfield-editable-row--toggle"),t.data("prepend")?s.prepend(n):s.append(n),s.children(".ss-gridfield-no-items:first").hide(),n.find("input:first").focus(),a&&d.addClass("ss-ui-action-constructive")},error:function(i){alert(ss.i18n._t("GRIDFIELD.ERRORINTRANSACTION")),d.removeClass("ss-gridfield-add-inline-extended--loading disabled")}})}else{var o=window.tmpl,g=this.find(".ss-gridfield-add-inline-extended--template:last");o.cache[this[0].id+"-ss-gridfield-add-inline-extended--template"]=o(g.html());var f=i(o(this[0].id+"-ss-gridfield-add-inline-extended--template",{num:n}));s.append(f),s.children(".ss-gridfield-no-items:first").hide(),f.find("input:first").focus()}this.data("add-inline-num",n+1)}}}),i(".ss-gridfield-add-new-inline-extended--button").entwine({onclick:function(){return this.getGridField().trigger("addnewinlinextended",[this]),!1}}),i(".ss-gridfield-inline-new-extended--row-delete").entwine({onclick:function(){var i=this.parents(".ss-gridfield:first");return confirm(ss.i18n._t("GridFieldExtensions.CONFIRMDEL","Are you sure you want to delete this?"))&&(this.parents("tbody:first").find("tr[data-inline-new-extended-row="+this.parents("tr[data-inline-new-extended-row]:first").data("inlineNewExtendedRow")+"]").remove(),i.showNoItemsMessage()),!1}}),i(".ss-gridfield-add-inline-extended--toggle").entwine({onclick:function(){var i=this.parents("tr:first");return this.toggleClass("ss-gridfield-add-inline-extended--toggle_open"),i.parent().find(".ss-gridfield-inline-new-extended--row--has-columns[data-inline-new-extended-row="+i.data("inlineNewExtendedRow")+"]").toggleClass("ss-gridfield-inline-new-extended--row--has-columns_open"),!1}}),i(".cms-container").entwine({OpenGridFieldToggles:{},saveTabState:function(){var e=this,d=e.getOpenGridFieldToggles();e._super(),e.find(".ss-gridfield.ss-gridfield-editable-rows").each(function(){var e=i(this),t=e.getOpenToggles();t.length&&(d[e.attr("id")]=e.getOpenToggles())})},restoreTabState:function(e){var d=this,t=d.getOpenGridFieldToggles();d._super(e),i.each(t,function(i,e){d.find("#"+i+".ss-gridfield.ss-gridfield-editable-rows").reopenToggles(e)}),d.find(".ss-gridfield-editable-row--toggle_start").click(),d.setOpenGridFieldToggles({})}}),i(".ss-gridfield.ss-gridfield-editable-rows").entwine({reload:function(i,e){var d=this,t=d.getOpenToggles(),s=arguments;this._super(i,function(){d.reopenToggles(t),d.find(".ss-gridfield-editable-row--toggle_start").click(),e&&e.apply(d,s)})},getOpenToggles:function(){var e=this,d=[];return e.hasClass("ss-gridfield-editable-rows_disableToggleState")?d:(e.find(".ss-gridfield-editable-row--toggle_open").each(function(e){var t=i(this),s=t.parents("td:first"),n=t.parents("tr:first"),a=n.parents(".ss-gridfield:first"),l=n.next();if(l.hasClass("ss-gridfield-editable-row--row")&&l.data("id")==n.data("id")&&l.data("class")==n.data("class")){if(a.hasClass("ss-gridfield-editable-rows_disableToggleState"))return!0}else l=null;d[e]={link:s.data("link")},l&&(l.find(".ss-tabset.ui-tabs").each(function(){d[e].tabs||(d[e].tabs={}),d[e].tabs[this.id]=i(this).tabs("option","selected")}),a.hasClass("ss-gridfield-editable-rows_allowCachedToggles")&&(d[e].row=l.detach()))}),d)},reopenToggles:function(e){var d=this,t=function(e,d){e.hasOwnProperty("tabs")&&e.tabs&&i.each(e.tabs,function(i,e){d.find("#"+i+".ss-tabset.ui-tabs").tabs({active:e})})};d.hasClass("ss-gridfield-editable-rows_disableToggleState")||i.each(e,function(i){if(!e[i].hasOwnProperty("link")||!e[i].link)return!0;var s=d.find("td.ss-gridfield-editable-row--icon-holder[data-link='"+e[i].link+"']");if(!s.length)return!0;if(e[i].hasOwnProperty("row")&&e[i].row){var n=s.parents("tr:first");s.find(".ss-gridfield-editable-row--toggle").addClass("ss-gridfield-editable-row--toggle_loaded ss-gridfield-editable-row--toggle_open"),n.next().hasClass("ss-gridfield-editable-row--row")||n.after(e[i].row)}else e[i].hasOwnProperty("link")&&e[i].link&&s.find(".ss-gridfield-editable-row--toggle").trigger("click",function(s){d.find(".ss-gridfield.ss-gridfield-editable-rows").reopenToggles(e),t(e[i],s)},!1)})}}),i(".ss-gridfield-editable-row--toggle").entwine({onclick:function(e,d,t){var s=this,n=s.parents("td:first"),a=n.data("link"),l=s.parents("tr:first");if(s.removeClass("ss-gridfield-editable-row--toggle_start"),l.hasClass("ss-gridfield-editable-row--loading"))return!1;if(a&&!s.hasClass("ss-gridfield-editable-row--toggle_loaded"))l.addClass("ss-gridfield-editable-row--loading"),i.ajax({url:a,dataType:"html",success:function(e){var n=i(e);s.addClass("ss-gridfield-editable-row--toggle_loaded ss-gridfield-editable-row--toggle_open"),l.addClass("ss-gridfield-editable-row--reference").removeClass("ss-gridfield-editable-row--loading"),l.after(n),n.find(".ss-gridfield-editable-row--toggle_start").click(),t!==!1&&n.find("input:first").focus(),"function"==typeof d&&d(n,s,l)},error:function(i){alert(ss.i18n._t("GRIDFIELD.ERRORINTRANSACTION")),l.removeClass("ss-gridfield-editable-row--loading")}});else if(a){var r=l.next();r.hasClass("ss-gridfield-editable-row--row")&&r.data("id")==l.data("id")&&r.data("class")==l.data("class")&&(s.toggleClass("ss-gridfield-editable-row--toggle_open"),s.hasClass("ss-gridfield-editable-row--toggle_open")?r.removeClass("ss-gridfield-editable-row--row_hide").find("input:first").focus():r.addClass("ss-gridfield-editable-row--row_hide"))}return!1}});var e;i(".ss-gridfield-range-slider--field.rangeslider.has-rangeslider").entwine({onchange:function(i){if(i.timeStamp!=e){e=i.timeStamp;var d=this.parents(".ss-gridfield-range-slider:first"),t=d.find(".ss-gridfield-range-slider--button");t.length&&t.click()}}}),i(".add-existing-picker-actions--add-items").entwine({onclick:function(i,e){var d=this.getDialog();this.addCloseDialogIfRequired(d),this.addItems(null,null,"",function(){e&&e(),d.data("grid").reload(),d.dialog("close")}),i.preventDefault()},getDialog:function(){return this.closest(".add-existing-search-dialog").children(".ui-dialog-content:first")},addItems:function(e,d,t,s,n){var a=this;e||(e=a.getDialog()),d||(d=e.data("items-to-add")||[]),d.length||(statusMessage(ss.i18n._t("GridField_AddExistingPicker.NO_ITEMS","No items selected"),"error"),e.find(".add-existing-search-items").children().length||e.dialog("close")),t||(t=e.find(".add-existing-picker-items").data("add-link")),s||(s=function(){e.data("grid")&&e.data("grid").reload()}),a.clearItemsToAdd(e),n||e.parent().addClass("loading loading_hiddenContents"),i.post(t,{ids:d},s).always(function(){e.parent().removeClass("loading loading_hiddenContents")})},undoItems:function(e,d,t,s,n){var a=this;d||(d=a.getDialog()),e.length&&(t||(t=d.find(".add-existing-picker-items").data("undo-link")),s||(s=function(){d.data("grid")&&d.data("grid").reload()}),n||d.parent().addClass("loading loading_hiddenContents"),i.post(t,{ids:e},function(){var i=[].slice.call(arguments);i.push(d),s.apply(this,i)}).always(function(){d.parent().removeClass("loading loading_hiddenContents")}))},clearItemsToAdd:function(i){i||(i=this.getDialog()),i.data("items-to-add",[])},addCloseDialogIfRequired:function(e){if(e||(e=this.getDialog()),!e.data("onClose")){var d=this;e.on("dialogbeforeclose",function(e,t){var s=i(this),n=s.data("items-to-add")||[];n.length&&confirm(ss.i18n.sprintf(ss.i18n._t("GridField_AddExistingPicker.CONFIRM","Would you like to add %s selected items to the current list?"),n.length))?d.addItems(s,n,"",function(){s.data("grid").reload()}):d.clearItemsToAdd(s)}),e.data("onClose",!0)}}}),i(".add-existing-picker-item--undo-holder .add-existing-picker-item--undo").entwine({onclick:function(e){var d=this.data("id"),t=this.data("undoLink"),s=this.data("title"),n=i('.add-existing-picker-items[data-undo-link="'+t+'"]').find('.add-existing-picker-item--link[data-id="'+d+'"]');n.undoItem(d,!0,function(e,d,t,a){a.data("grid").reload(),i.noticeRemove(i(".notice-item.add-existing-picker-item--undo-holder")),statusMessage(ss.i18n.sprintf(ss.i18n._t("GridField_AddExistingPicker.ITEM_REMOVED","%s has been removed."),s)),n.parent("li:first").show()}),e.preventDefault()}}),i(".add-existing-search-dialog .add-existing-search-items.add-existing-picker-items a").entwine({onclick:function(e){var d=this.getButton(),t=d.getDialog(),s=t.data("grid"),n=this.parent(),a=t.data("items-to-add")||[],l=this.data("id");if(s&&s.hasClass("ss-gridfield-add-existing-picker_async")){var r=t.find(".add-existing-picker-items").data("undo-link"),o=this.text();n.addClass("loading add-existing-picker-item_toAdd"),d.addItems(t,[l],"",function(e){var d=e&&e.hasOwnProperty("keep")&&e.keep;t.data("grid")&&t.data("grid").reload(),n.removeClass("add-existing-picker-item_toAdd loading"),d||n.hide(),i.noticeAdd({text:ss.i18n.sprintf(ss.i18n._t("GridField_AddExistingPicker.ITEM_ADDED","%s has been added. %s"),o,ss.i18n.sprintf('<button type="button" class="add-existing-picker-item--undo" data-id="%s" data-undo-link="%s" data-title="%s" data-keep="%s">%s</button>',l,r,o,d?"true":"false",ss.i18n._t("UNDO","Undo"))),type:"add-existing-picker-item--undo-holder",stayTime:5e3})},!0)}else d.addCloseDialogIfRequired(t),a.indexOf(l)===-1?(a.push(l),n.addClass("add-existing-picker-item_toAdd")):(a.splice(a.indexOf(l),1),n.removeClass("add-existing-picker-item_toAdd")),t.data("items-to-add",a);e.preventDefault()},getButton:function(){return this.closest(".add-existing-search-dialog").find(".add-existing-picker-actions--add-items:first")},undoItem:function(i,e,d){i||(i=this.data("id"));var t=this.getButton();t.undoItems([i],null,"",d,e)}}),i("select.ss-gridfield--tags-column--selector.select2").entwine({onmatch:function(e){this._super();var d=this,t=d.parents(".gridfield:first"),s=d.data("gfNewLink");s&&this.data("select2").on("select",function(e){e&&e.data.hasOwnProperty("isNew")&&e.data.isNew&&(d.prop("disabled",!0),i.ajax({type:"POST",url:s.replace("{{ tag }}",e.data.id),success:function(i){},complete:function(){d.prop("disabled",!1),t.reload()}}))})},configuration:function(e){var d=this._super(e);return d.createTag=function(e){var d=i.trim(e.term);return""===d?null:{id:d,text:d,isNew:!0}},d}}),i(".ss-gridfield-timeline.ss-gridfield-editable-rows .ss-gridfield-editable-row--toggle").entwine({onmatch:function(){this._super(),this.parents("tr:first").addClass("ss-gridfield-timeline--row_with-details")}}),i(".ss-gridfield-timeline.ss-gridfield-editable-rows tr.ss-gridfield-item").entwine({onclick:function(e){e.target&&(i(e.target).is("a,button,input")||i(e.target).parent().is("a,button,input"))||this.find(".ss-gridfield-editable-row--toggle:first").first().click()}}),i(".ss-gridfield").entwine({reload:function(e,d){var t=this;this._super(e,function(e){t.attr("class",i(e).attr("class")),d&&d.apply(this,arguments)})}})})}(jQuery);